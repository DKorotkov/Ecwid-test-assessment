export class Egallary{constructor(e){this.className=e,this.gallery=document.querySelector(`.${e}`),this.init()}init(){this.gallery?(this.loadDepend(),this.gallery.addEventListener("click",(e=>this.clickOnGallery(e))),this.gallery.addEventListener("dragover",(e=>{this.startDrag(e)})),this.gallery.addEventListener("dragenter",(e=>{this.startDrag(e)})),this.gallery.addEventListener("drop",(e=>{e.stopPropagation(),e.preventDefault(),this.loadByDrop(e),this.stopDrag()})),this.gallery.addEventListener("dragleave",(()=>{this.stopDrag()}))):console.error(`Class ${this.className} not found on page`)}loadDepend(){const e=document.getElementsByTagName("head")[0],t=this.retrieveURL("gallery.min");if(!t)return void console.error("gallery.min.js not find");const s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=t+"/css/gallery.min.css",e.appendChild(s);const a=new XMLHttpRequest,r=this.gallery;a.open("GET",t+"/html/template.html",!0),a.onreadystatechange=function(){4===this.readyState&&200===this.status&&(r.innerHTML=this.responseText)},a.send()}startDrag(e){e.stopPropagation(),e.preventDefault(),this.gallery.classList.add(`${this.className}--drag-start`)}stopDrag(){this.gallery.classList.remove(`${this.className}--drag-start`)}loadByDrop(e){[...e.dataTransfer.files].forEach((e=>{const t=new FileReader;t.onload=e=>{this.addImage(e.target.result)},t.readAsDataURL(e)}))}clickOnGallery(e){const t=e.target,s=this.gallery.querySelector(`.${this.className}__input-load`),a=this.gallery.querySelector(`.${this.className}__input-file`);if(t.classList.contains(`${this.className}__button-load`)&&(a&&a.addEventListener("change",(e=>{const t=e.target.files[0];if(!t)return;let s=new FileReader;s.readAsText(t),s.onerror=function(){console.error(s.error)},s.onload=()=>{try{JSON.parse(s.result).galleryImages.forEach((e=>{this.addImage(e.url,e.width,e.height)}))}catch(e){return console.error(e.message),void console.error("The data in the file does not contain a JSON object")}},a.value=""})),""!==s.value?this.addImage(s.value):a.click()),t.classList.contains(`${this.className}__image-btn-delete`)||t.classList.contains(`${this.className}__image-btn-delete-icon`)){const e=this.closest(t,`.${this.className}__image-wrapper`);this.checkCountImages(),e.remove()}}addImage(e,t=null,s=null){this.gallery.classList.add(`${this.className}--active`);const a=this.gallery.querySelector(`.${this.className}__imgs-list`),r=this.gallery.querySelector(`.${this.className}__template-image`).content.cloneNode(!0),l=r.querySelector(`.${this.className}__image-wrapper`),i=new Image(t,s);i.classList.add("e-gallery__image"),i.src=e,null!==t&&null!==s||(l.classList.add(`${this.className}__image-loading`),i.onerror=()=>{l.remove(),this.checkCountImages()},i.onload=()=>{l.classList.remove(`${this.className}__image-loading`)}),l.prepend(i),a.prepend(r)}checkCountImages(){[...this.gallery.querySelectorAll(`.${this.className}__image-wrapper`)].length<=1&&this.gallery.classList.remove(`${this.className}--active`)}closest(e,t){if(Element.prototype.closest)return e.closest(t);let s=e;for(;s;){if(s.matches(t))return s;s=s.parentElement}return null}retrieveURL=function(e){var t=document.getElementsByTagName("script");if(t&&t.length>0)for(var s in t)if(t[s].src&&t[s].src.match(new RegExp(e+"\\.js$")))return t[s].src.replace(new RegExp("(.*)"+e+"\\.js$"),"$1")}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdhbGxlcnkubWluLmpzIl0sIm5hbWVzIjpbIkVnYWxsYXJ5IiwiY29uc3RydWN0b3IiLCJjbGFzc05hbWUiLCJ0aGlzIiwiZ2FsbGVyeSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImluaXQiLCJsb2FkRGVwZW5kIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJjbGlja09uR2FsbGVyeSIsImV2ZW50Iiwic3RhcnREcmFnIiwic3RvcFByb3BhZ2F0aW9uIiwicHJldmVudERlZmF1bHQiLCJsb2FkQnlEcm9wIiwic3RvcERyYWciLCJjb25zb2xlIiwiZXJyb3IiLCJoZWFkIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXRoIiwicmV0cmlldmVVUkwiLCJsaW5rIiwiY3JlYXRlRWxlbWVudCIsInJlbCIsInR5cGUiLCJocmVmIiwiYXBwZW5kQ2hpbGQiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsImdsIiwib3BlbiIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJpbm5lckhUTUwiLCJyZXNwb25zZVRleHQiLCJzZW5kIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwiZGF0YVRyYW5zZmVyIiwiZmlsZXMiLCJmb3JFYWNoIiwiZmlsZSIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJhZGRJbWFnZSIsInRhcmdldCIsInJlc3VsdCIsInJlYWRBc0RhdGFVUkwiLCJpbnB1dExvYWQiLCJpbnB1dEZpbGUiLCJjb250YWlucyIsInJlYWRBc1RleHQiLCJvbmVycm9yIiwiSlNPTiIsInBhcnNlIiwiaW1hZ2UiLCJ1cmwiLCJ3aWR0aCIsImhlaWdodCIsIm1lc3NhZ2UiLCJ2YWx1ZSIsImNsaWNrIiwiaW1hZ2VXcmFwcGVyIiwiY2xvc2VzdCIsImNoZWNrQ291bnRJbWFnZXMiLCJpbWdzTGlzdCIsImNsb25lIiwiY29udGVudCIsImNsb25lTm9kZSIsImltZ1dyIiwiSW1hZ2UiLCJzcmMiLCJwcmVwZW5kIiwicXVlcnlTZWxlY3RvckFsbCIsImxlbmd0aCIsImVsIiwic2VsZWN0b3IiLCJFbGVtZW50IiwicHJvdG90eXBlIiwicGFyZW50IiwibWF0Y2hlcyIsInBhcmVudEVsZW1lbnQiLCJmaWxlbmFtZSIsInNjcmlwdHMiLCJpIiwibWF0Y2giLCJSZWdFeHAiLCJyZXBsYWNlIl0sIm1hcHBpbmdzIjoiT0FBTyxNQUFNQSxTQUNWQyxZQUFZQyxHQUNUQyxLQUFLRCxVQUFZQSxFQUNqQkMsS0FBS0MsUUFBVUMsU0FBU0MsY0FBYyxJQUFJSixLQUMxQ0MsS0FBS0ksT0FHUkEsT0FDUUosS0FBS0MsU0FLVkQsS0FBS0ssYUFDTEwsS0FBS0MsUUFBUUssaUJBQWlCLFNBQVVDLEdBQU1QLEtBQUtRLGVBQWVELEtBRWxFUCxLQUFLQyxRQUFRSyxpQkFBaUIsWUFBYUcsSUFDeENULEtBQUtVLFVBQVVELE1BRWxCVCxLQUFLQyxRQUFRSyxpQkFBaUIsYUFBY0csSUFDekNULEtBQUtVLFVBQVVELE1BRWxCVCxLQUFLQyxRQUFRSyxpQkFBaUIsUUFBU0csSUFDcENBLEVBQU1FLGtCQUNORixFQUFNRyxpQkFDTlosS0FBS2EsV0FBV0osR0FDaEJULEtBQUtjLGNBRVJkLEtBQUtDLFFBQVFLLGlCQUFpQixhQUFhLEtBQ3hDTixLQUFLYyxlQXBCTEMsUUFBUUMsTUFBTSxTQUFTaEIsS0FBS0QsK0JBd0JsQ00sYUFDRyxNQUFNWSxFQUFPZixTQUFTZ0IscUJBQXFCLFFBQVEsR0FDN0NDLEVBQU9uQixLQUFLb0IsWUFBWSxlQUM5QixJQUFLRCxFQUVGLFlBREFKLFFBQVFDLE1BQU0sMkJBSWpCLE1BQU1LLEVBQU9uQixTQUFTb0IsY0FBYyxRQUNwQ0QsRUFBS0UsSUFBTSxhQUNYRixFQUFLRyxLQUFPLFdBQ1pILEVBQUtJLEtBQU9OLEVBQU8sdUJBQ25CRixFQUFLUyxZQUFZTCxHQUVqQixNQUFNTSxFQUFNLElBQUlDLGVBQ1ZDLEVBQUs3QixLQUFLQyxRQUNoQjBCLEVBQUlHLEtBQUssTUFBT1gsRUFBTyx1QkFBdUIsR0FDOUNR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QUFJQyxRQUFRQyxVQUFVZixRQUNuQixPQUFPWSxFQUFHWixRQUFRYSxHQUVyQixJQUFJRyxFQUFTSixFQUNiLEtBQU9JLEdBQVEsQ0FDWixHQUFJQSxFQUFPQyxRQUFRSixHQUNoQixPQUFPRyxFQUVWQSxFQUFTQSxFQUFPRSxjQUVuQixPQUFPLEtBSVZoRSxZQUFjLFNBQVVpRSxHQUNyQixJQUFJQyxFQUFVcEYsU0FBU2dCLHFCQUFxQixVQUM1QyxHQUFJb0UsR0FBV0EsRUFBUVQsT0FBUyxFQUM3QixJQUFLLElBQUlVLEtBQUtELEVBQ1gsR0FBSUEsRUFBUUMsR0FBR2IsS0FBT1ksRUFBUUMsR0FBR2IsSUFBSWMsTUFBTSxJQUFJQyxPQUFPSixFQUFXLFdBQzlELE9BQU9DLEVBQVFDLEdBQUdiLElBQUlnQixRQUFRLElBQUlELE9BQU8sT0FBU0osRUFBVyxVQUFXIiwiZmlsZSI6ImdhbGxlcnkubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIEVnYWxsYXJ5IHtcclxuICAgY29uc3RydWN0b3IoY2xhc3NOYW1lKSB7XHJcbiAgICAgIHRoaXMuY2xhc3NOYW1lID0gY2xhc3NOYW1lO1xyXG4gICAgICB0aGlzLmdhbGxlcnkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHtjbGFzc05hbWV9YCk7XHJcbiAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICB9XHJcblxyXG4gICBpbml0KCkge1xyXG4gICAgICBpZiAoIXRoaXMuZ2FsbGVyeSkge1xyXG4gICAgICAgICBjb25zb2xlLmVycm9yKGBDbGFzcyAke3RoaXMuY2xhc3NOYW1lfSBub3QgZm91bmQgb24gcGFnZWApO1xyXG4gICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgLy8gTG9hZCBkZXBlbmRlbmNpZXNcclxuICAgICAgdGhpcy5sb2FkRGVwZW5kKCk7XHJcbiAgICAgIHRoaXMuZ2FsbGVyeS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHRoaXMuY2xpY2tPbkdhbGxlcnkoZSkpO1xyXG5cclxuICAgICAgdGhpcy5nYWxsZXJ5LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgdGhpcy5zdGFydERyYWcoZXZlbnQpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5nYWxsZXJ5LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnZW50ZXJcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgIHRoaXMuc3RhcnREcmFnKGV2ZW50KTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuZ2FsbGVyeS5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgIHRoaXMubG9hZEJ5RHJvcChldmVudCk7XHJcbiAgICAgICAgIHRoaXMuc3RvcERyYWcoKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuZ2FsbGVyeS5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2xlYXZlXCIsICgpID0+IHtcclxuICAgICAgICAgdGhpcy5zdG9wRHJhZygpO1xyXG4gICAgICB9KTtcclxuICAgfVxyXG5cclxuICAgbG9hZERlcGVuZCgpIHtcclxuICAgICAgY29uc3QgaGVhZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXTtcclxuICAgICAgY29uc3QgcGF0aCA9IHRoaXMucmV0cmlldmVVUkwoXCJnYWxsZXJ5Lm1pblwiKTtcclxuICAgICAgaWYgKCFwYXRoKSB7XHJcbiAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJnYWxsZXJ5Lm1pbi5qcyBub3QgZmluZFwiKTtcclxuICAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpbmtcIik7XHJcbiAgICAgIGxpbmsucmVsID0gXCJzdHlsZXNoZWV0XCI7XHJcbiAgICAgIGxpbmsudHlwZSA9IFwidGV4dC9jc3NcIjtcclxuICAgICAgbGluay5ocmVmID0gcGF0aCArIFwiL2Nzcy9nYWxsZXJ5Lm1pbi5jc3NcIjtcclxuICAgICAgaGVhZC5hcHBlbmRDaGlsZChsaW5rKTtcclxuXHJcbiAgICAgIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICBjb25zdCBnbCA9IHRoaXMuZ2FsbGVyeTtcclxuICAgICAgeGhyLm9wZW4oXCJHRVRcIiwgcGF0aCArIFwiL2h0bWwvdGVtcGxhdGUuaHRtbFwiLCB0cnVlKTtcclxuICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSAhPT0gNCkgcmV0dXJuO1xyXG4gICAgICAgICBpZiAodGhpcy5zdGF0dXMgIT09IDIwMCkgcmV0dXJuO1xyXG4gICAgICAgICBnbC5pbm5lckhUTUwgPSB0aGlzLnJlc3BvbnNlVGV4dDtcclxuICAgICAgfTtcclxuICAgICAgeGhyLnNlbmQoKTtcclxuICAgfVxyXG5cclxuICAgc3RhcnREcmFnKGV2ZW50KSB7XHJcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAvLyBldmVudC5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9IFwiY29weVwiO1xyXG4gICAgICB0aGlzLmdhbGxlcnkuY2xhc3NMaXN0LmFkZChgJHt0aGlzLmNsYXNzTmFtZX0tLWRyYWctc3RhcnRgKTtcclxuICAgfVxyXG5cclxuICAgc3RvcERyYWcoKSB7XHJcbiAgICAgIHRoaXMuZ2FsbGVyeS5jbGFzc0xpc3QucmVtb3ZlKGAke3RoaXMuY2xhc3NOYW1lfS0tZHJhZy1zdGFydGApO1xyXG4gICB9XHJcblxyXG4gICBsb2FkQnlEcm9wKGV2ZW50KSB7XHJcbiAgICAgIGNvbnN0IGZpbGVzID0gWy4uLmV2ZW50LmRhdGFUcmFuc2Zlci5maWxlc107XHJcbiAgICAgIGZpbGVzLmZvckVhY2goKGZpbGUpID0+IHtcclxuICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmFkZEltYWdlKGV2ZW50LnRhcmdldC5yZXN1bHQpO1xyXG4gICAgICAgICB9O1xyXG4gICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcclxuICAgICAgfSk7XHJcbiAgIH1cclxuXHJcbiAgIGNsaWNrT25HYWxsZXJ5KGV2ZW50KSB7XHJcbiAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDtcclxuICAgICAgY29uc3QgaW5wdXRMb2FkID0gdGhpcy5nYWxsZXJ5LnF1ZXJ5U2VsZWN0b3IoYC4ke3RoaXMuY2xhc3NOYW1lfV9faW5wdXQtbG9hZGApO1xyXG4gICAgICBjb25zdCBpbnB1dEZpbGUgPSB0aGlzLmdhbGxlcnkucXVlcnlTZWxlY3RvcihgLiR7dGhpcy5jbGFzc05hbWV9X19pbnB1dC1maWxlYCk7XHJcblxyXG4gICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhgJHt0aGlzLmNsYXNzTmFtZX1fX2J1dHRvbi1sb2FkYCkpIHtcclxuICAgICAgICAgaWYgKGlucHV0RmlsZSlcclxuICAgICAgICAgICAgaW5wdXRGaWxlLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgY29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdO1xyXG4gICAgICAgICAgICAgICBpZiAoIWZpbGUpIHJldHVybjtcclxuICAgICAgICAgICAgICAgLy8gaW5wdXRMb2FkLnZhbHVlID0gZmlsZS5uYW1lO1xyXG4gICAgICAgICAgICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7XHJcbiAgICAgICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHJlYWRlci5lcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW1nRGF0YSA9IEpTT04ucGFyc2UocmVhZGVyLnJlc3VsdClbXCJnYWxsZXJ5SW1hZ2VzXCJdO1xyXG4gICAgICAgICAgICAgICAgICAgICBpbWdEYXRhLmZvckVhY2goKGltYWdlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkSW1hZ2UoaW1hZ2UudXJsLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVGhlIGRhdGEgaW4gdGhlIGZpbGUgZG9lcyBub3QgY29udGFpbiBhIEpTT04gb2JqZWN0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgaW5wdXRGaWxlLnZhbHVlID0gXCJcIjtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICBpZiAoaW5wdXRMb2FkLnZhbHVlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkSW1hZ2UoaW5wdXRMb2FkLnZhbHVlKTtcclxuICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaW5wdXRGaWxlLmNsaWNrKCk7XHJcbiAgICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoYCR7dGhpcy5jbGFzc05hbWV9X19pbWFnZS1idG4tZGVsZXRlYCkgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhgJHt0aGlzLmNsYXNzTmFtZX1fX2ltYWdlLWJ0bi1kZWxldGUtaWNvbmApKSB7XHJcbiAgICAgICAgIGNvbnN0IGltYWdlV3JhcHBlciA9IHRoaXMuY2xvc2VzdCh0YXJnZXQsIGAuJHt0aGlzLmNsYXNzTmFtZX1fX2ltYWdlLXdyYXBwZXJgKTtcclxuICAgICAgICAgdGhpcy5jaGVja0NvdW50SW1hZ2VzKCk7XHJcbiAgICAgICAgIGltYWdlV3JhcHBlci5yZW1vdmUoKTtcclxuICAgICAgfVxyXG4gICB9XHJcblxyXG4gICBhZGRJbWFnZSh1cmwsIHdpZHRoID0gbnVsbCwgaGVpZ2h0ID0gbnVsbCkge1xyXG4gICAgICB0aGlzLmdhbGxlcnkuY2xhc3NMaXN0LmFkZChgJHt0aGlzLmNsYXNzTmFtZX0tLWFjdGl2ZWApO1xyXG4gICAgICBjb25zdCBpbWdzTGlzdCA9IHRoaXMuZ2FsbGVyeS5xdWVyeVNlbGVjdG9yKGAuJHt0aGlzLmNsYXNzTmFtZX1fX2ltZ3MtbGlzdGApO1xyXG5cclxuICAgICAgY29uc3QgdGVtcGxhdGUgPSB0aGlzLmdhbGxlcnkucXVlcnlTZWxlY3RvcihgLiR7dGhpcy5jbGFzc05hbWV9X190ZW1wbGF0ZS1pbWFnZWApO1xyXG4gICAgICBjb25zdCBjbG9uZSA9IHRlbXBsYXRlLmNvbnRlbnQuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgICBjb25zdCBpbWdXciA9IGNsb25lLnF1ZXJ5U2VsZWN0b3IoYC4ke3RoaXMuY2xhc3NOYW1lfV9faW1hZ2Utd3JhcHBlcmApO1xyXG5cclxuICAgICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2Uod2lkdGgsIGhlaWdodCk7XHJcbiAgICAgIGltYWdlLmNsYXNzTGlzdC5hZGQoXCJlLWdhbGxlcnlfX2ltYWdlXCIpO1xyXG4gICAgICBpbWFnZS5zcmMgPSB1cmw7XHJcblxyXG4gICAgICBpZiAod2lkdGggPT09IG51bGwgfHwgaGVpZ2h0ID09PSBudWxsKSB7XHJcbiAgICAgICAgIGltZ1dyLmNsYXNzTGlzdC5hZGQoYCR7dGhpcy5jbGFzc05hbWV9X19pbWFnZS1sb2FkaW5nYCk7XHJcbiAgICAgICAgIGltYWdlLm9uZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGltZ1dyLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrQ291bnRJbWFnZXMoKTtcclxuICAgICAgICAgfTtcclxuICAgICAgICAgaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBpbWdXci5jbGFzc0xpc3QucmVtb3ZlKGAke3RoaXMuY2xhc3NOYW1lfV9faW1hZ2UtbG9hZGluZ2ApO1xyXG4gICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpbWdXci5wcmVwZW5kKGltYWdlKTtcclxuICAgICAgaW1nc0xpc3QucHJlcGVuZChjbG9uZSk7XHJcbiAgIH1cclxuXHJcbiAgIGNoZWNrQ291bnRJbWFnZXMoKSB7XHJcbiAgICAgIGNvbnN0IHdyYXBwZXJzID0gWy4uLnRoaXMuZ2FsbGVyeS5xdWVyeVNlbGVjdG9yQWxsKGAuJHt0aGlzLmNsYXNzTmFtZX1fX2ltYWdlLXdyYXBwZXJgKV07XHJcbiAgICAgIGlmICh3cmFwcGVycy5sZW5ndGggPD0gMSkgdGhpcy5nYWxsZXJ5LmNsYXNzTGlzdC5yZW1vdmUoYCR7dGhpcy5jbGFzc05hbWV9LS1hY3RpdmVgKTtcclxuICAgfVxyXG5cclxuICAgLy8g0J3QsNGF0L7QtNC40YIg0YDQvtC00LjRgtC10LvRjyDQv9C+INGB0LXQu9C10LrRgtC+0YDRg1xyXG4gICBjbG9zZXN0KGVsLCBzZWxlY3Rvcikge1xyXG4gICAgICBpZiAoRWxlbWVudC5wcm90b3R5cGUuY2xvc2VzdCkge1xyXG4gICAgICAgICByZXR1cm4gZWwuY2xvc2VzdChzZWxlY3Rvcik7XHJcbiAgICAgIH1cclxuICAgICAgbGV0IHBhcmVudCA9IGVsO1xyXG4gICAgICB3aGlsZSAocGFyZW50KSB7XHJcbiAgICAgICAgIGlmIChwYXJlbnQubWF0Y2hlcyhzZWxlY3RvcikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBhcmVudDtcclxuICAgICAgICAgfVxyXG4gICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50RWxlbWVudDtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgfVxyXG5cclxuICAgLy8g0J3QsNGF0L7QtNC40YIg0L/Rg9GC0Ywg0Log0YTQsNC50LvRgyBqc1xyXG4gICByZXRyaWV2ZVVSTCA9IGZ1bmN0aW9uIChmaWxlbmFtZSkge1xyXG4gICAgICB2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xyXG4gICAgICBpZiAoc2NyaXB0cyAmJiBzY3JpcHRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgZm9yICh2YXIgaSBpbiBzY3JpcHRzKSB7XHJcbiAgICAgICAgICAgIGlmIChzY3JpcHRzW2ldLnNyYyAmJiBzY3JpcHRzW2ldLnNyYy5tYXRjaChuZXcgUmVnRXhwKGZpbGVuYW1lICsgXCJcXFxcLmpzJFwiKSkpIHtcclxuICAgICAgICAgICAgICAgcmV0dXJuIHNjcmlwdHNbaV0uc3JjLnJlcGxhY2UobmV3IFJlZ0V4cChcIiguKilcIiArIGZpbGVuYW1lICsgXCJcXFxcLmpzJFwiKSwgXCIkMVwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgfTtcclxufVxyXG4iXX0=
